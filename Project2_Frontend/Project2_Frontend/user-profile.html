<!DOCTYPE html>
<html lang="en">
<head>
    <title>User Profile</title>
    <!--navigation top style sheet-->
	<link rel="stylesheet" href="navigation-top.css">
	<!--navigation to sidebar style sheet-->
	<link rel="stylesheet" href="sidebar-nav.css">
    <style>
        #mainbody {
            text-align: center;
            padding-top: 0;
            width: 100%;
        }

        table {
            width: 80%;
            padding-bottom: 20%;
            float: right;
            background: rgb(230,230,230);
            
        }
    </style>
</head>
<body style="background-color:whitesmoke;">
		<!--navigation top-->
		<div class="topnav" id="myTopnav">
			<a id="home-page" class="glossymenu" href="bankWelcomePage.html"> ::: WELCOME :::</a><br>
			<a id="about-page" class="glossymenu" href="about-page.html">::: ABOUT US :::</a><br>
			<a id="login-page" class="glossymenu" href="proj2Login.html">::: LOGIN / SIGNUP :::</a><br>
			<a id="service-page" class="glossymenu" href="customer-service.html">::: HELP :::</a>
		</div>
		<!--end of navigation top-->

	<h1 id="mainbody"></h1>
    <br>
    <br>
    <h1 style="text-align:center;">Accounts</h1>
    <div>
        <h3>Delete Account</h3>
        <label for="deleteInput">Account ID:</label>
        <input type="number" id="deleteInput" value="1" min="1">
        <button type="submit" onclick="delAcct()" style="display: block; margin: 0 auto;">Delete Account</button>
    </div>

    <!-- <div>
        <h3>View Credit Request</h3>
        <label for="idInputOne">Request ID:</label>
        <input type="number" id="idInputOne" value="1" min="1">
        <button type="submit" onclick="getrequestcredit() "style="display: block; margin: 0 auto;">Get Request</button>
    </div> -->

	<!--side navigation-->
	<div id="mySidenav" class="sidenav">
		<a id="profile-home" href="user-profile.html">Profile Home</a>
		<a id="request-page" href="request-page.html">Make a Request (Credit, Loan, Job)</a>
        <a id="welcome-page" href="bankWelcomePage.html">Log Out</a>
	</div>
	<!--end of side navigation-->

	<div id="tableA">
    <table>
		<tbody id="userProfile">
            <tr>
                <td>ACCOUNT</td>
                <td id="acct">-</td>
            </tr>
            <tr>
                <td>USER</td>
                <td id="user">-</td>
            </tr>
            <tr>
                <td>TYPE</td>
                <td id="type">-</td>
            </tr>
            <tr>
                <td>BALANCE</td>
                <td id="bal">-</td>
            </tr>
		</tbody>
	</table>
    <button type="submit" onclick="getUser()" style="display: block; margin: 0 auto;">View Accounts</button>
    </div>
    
    <div id="tableB">
    <table>
        <tbody id ="creditRequest">
            <tr>
                <td>ID</td>
                <td id="req">-</td>
            </tr>
            <tr>
                <td>USER</td>
                <td id="user2">-</td>
            </tr>
            <tr>
                <td>TYPE</td>
                <td id="type2">-</td>
            </tr>
            <tr>
                <td>LIMIT</td>
                <td id="limit">-</td>
            </tr>
            <tr>
                <td>STATUS</td>
                <td id="status">-</td>
            </tr>
        </tbody>
    </table>
    <button type="submit" onclick="getrequestcredit() "style="display: block; margin: 0 auto;">Get Credit Request</button>
    </div>

	<div id="tableC">
    <table>
        <tbody id="accountProfile">
            <tr>
                <td>ACCOUNT</td>
                <td id="account_table">
                    <input type="number" id="account" value="1" min="1">
                </td>
            </tr>
            <tr>
                <td>USER</td>
                <td id="user3_table">
                    <input type="number" id="user3" value="1" min="1">
                </td>
            </tr>
            <tr>
                <td>TYPE</td>
                <td id="type3_table">
                    <input type="text" id="type3">
                </td>
            </tr>
            <tr>
                <td>BALANCE</td>
                <td id="balance_table">
                    <input type="number" id="balance" value="0.00" min="0">
                </td>
            </tr>
        </tbody>
    </table>
    <button type="submit" onclick="putAcct()" style="display: block; margin: 0 auto;">Update Account</button>
    </div>

</body>
<script>

var firstName = sessionStorage.getItem('firstName');
document.getElementById("mainbody").innerHTML = "Welcome, to your profile " + firstName
    acct = document.getElementById("acct").innerHTML
    userId = parseInt(sessionStorage.getItem('userID'))
   // const user = document.getElementById("user").innerHTML
    type = document.getElementById("type").innerHTML
    bal = document.getElementById("bal").innerHTML

function populateTableA(body) {
    console.log(body)
    //body = JSON.parse(body);
    console.log(typeof(body));
    document.getElementById("acct").innerHTML = body['acctId']
    document.getElementById("user").innerHTML = body['userId']
    document.getElementById("type").innerHTML = body['accountType']
    document.getElementById("bal").innerHTML = body['accountBalance']
}

function populateTableB(body) {
    console.log(Object.keys(body))
	//console.log(JSON.parse(body[0])['reqId'])
    //body = JSON.parse(body);
    console.log(typeof(body));
    document.getElementById("req").innerHTML = body[0].reqId
    document.getElementById("user2").innerHTML = body[0].userId
    document.getElementById("type2").innerHTML = body[0].cardType
    document.getElementById("limit").innerHTML = body[0].creditLimit
    document.getElementById("status").innerHTML = body[0].reqStatus
}

function populateTableC(body) {
    console.log(body)
    //body = JSON.parse(body);
    console.log(typeof(body));
    document.getElementById("account").innerHTML = body['acctId']
    document.getElementById("user3").innerHTML = body['userId']
    document.getElementById("type3").innerHTML = body['accountType']
    document.getElementById("balance").innerHTML = body['accountBalance']
}

async function getrequestcredit() {
    user_id = parseInt(sessionStorage.getItem('userID'))
    const url = `http://127.0.0.1:5000/requests/credit/${user_id}`
    const httpResponse = await fetch(url)
    const body = await httpResponse.json()
    console.log(body)
    populateTableB(body)
}

async function putAcct(){
    const acct_id = document.getElementById("account").value
    const user_id = document.getElementById("user3").value
    const account_type = document.getElementById("type3").value
    const account_balance = document.getElementById("balance").value

    const data = {
        acctId: acct_id,
        userId: user_id,
        accountType: account_type,
        accountBalance: account_balance
    }

    const url = `http://127.0.0.1:5000/account/${acct_id}`
    const httpResponce = await fetch(url, {
        method:"PUT",
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    });

    const body = await httpResponce
    console.log(body);
    if(body) {
        console.log("Successfully Updated")
    }
    else{
       Console.log("Unsuccessfull Please try again")
}
}

async function delAcct(){
    const acct_id = document.getElementById("deleteInput").value
    const url = `http://127.0.0.1:5000/user/${acct_id}`
    const httpResponce = await fetch(url, {
        method:"DELETE"});
    const body = await httpResponce
    console.log(body);
    if(body) {
        alert("Account successfully deleted")
    }
    else {
        alert("Failed to delete Account")
    }
}

async function getUser() {
    correct = false;
    // let acct = document.getElementById("acct").innerHTML
    // let userId = parseInt(sessionStorage.getItem('userID'))
    // //let user = document.getElementById("user").innerHTML
    // let type = document.getElementById("type").innerHTML
    // let bal = document.getElementById("bal").innerHTML

    console.log("Getting Accounts")

    const httpResponse = await fetch(`http://127.0.0.1:5000/accounts/${userId}`)
    console.log(httpResponse)

    const body = await httpResponse.json()
    
    let result = []
    for(var i in body){
        result.push(body[i])
    }
    console.log(result);
    // acct = result[i].acctId
    // user = result[i].userId
    // type = result[i].accountType
    // bal = result[i].accountBalance

    for (var i = 0; i < result.length; i++) {
	    acct = result[i].acct_id;
	    user = result[i].user_id;
	    type = result[i].account_type;
	    bal = result[i].account_balance

    }

    populateTableA(result[0])

    // const url = `http://127.0.0.1:5000/accounts/${userId}`;

    // const request = {
    //     'acctId': acct,
    //     'userId': userId,
    //     'accountType': type,
    //     'accountBalance': bal
	// }

	// console.log(request)

	// const httpresponse = fetch(url, {
	// 	method: 'GET',
	// 	body: JSON.stringify(request),
	// 	headers: {
	// 		"Content-type": "request/json; charset=UTF-8"
	// 	}
	// });

	// httpresponse.then(response => {
	// 	if(response.status==200){
    //         correct = true;
	// 	}else{
	// 		alert("Please try again - Could not get accounts");
    //         console.log("Failure"); 
	// 	}
	// })
    
    
}



</script>
<!--JS file for navigation top-->
<script src="navigation-top.js"></script>
</html>
