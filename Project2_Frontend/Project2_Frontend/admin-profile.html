<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Profile</title>
    <!--navigation top style sheet-->
	<link rel="stylesheet" href="navigation-top.css">
	<style>
		#mainbody {
            text-align: center;
            padding-top: 0;
            width: 100%;
        }

        table {
            width: 65%;
            float: left;
			padding-left:38%;
        }
		
		tr, td {
            background-color: rgb(230,230,230);
        }
	</style>
</head>
<body style="background-color:whitesmoke;">
		<!--navigation top-->
		<div class="topnav" id="myTopnav">
			<a id="home-page" class="glossymenu" href="bankWelcomePage.html"> ::: WELCOME :::</a><br>
			<a id="about-page" class="glossymenu" href="about-page.html">::: ABOUT US :::</a><br>
			<a id="login-page" class="glossymenu" href="proj2Login.html">::: LOGIN / SIGNUP :::</a><br>
			<a id="profile-home" href="user-profile.html">::: PROFILE HOME :::</a><br>
            <a id="request-page" href="request-page.html">::: MAKE REQUESTS:::</a><br>
			<a id="service-page" class="glossymenu" href="customer-service.html">::: HELP :::</a><br>
		</div>
		<!--end of navigation top-->

	<h1 id="mainbody"></h1>
    <h1 style="text-align:center;">Admin</h1>

    <br>
	<h2 style="text-align:center; text-decoration:underline;">Admin Request Actions</h2>
    <br>

	<div id="viewRequests" style="float:left; padding-left:42%;">
		<h3>View Submitted Requests (Credit):</h3>
		<div>
			<label for="idInput">User ID:</label>
			<input type="number" id="idInput" value="1" min="1">
		</div>
		<br>
		<button type="submit" onclick="getrequestcredit()" style="display: block; margin: 0 auto;">Get Credit Request</button>
		<br>
		<button type="submit" onclick="approvecredit()" style="display: block; margin: 0 auto;">Approve Credit Request</button>
		<br>
	</div>
	<div id="table">
		<table>
			<tbody>
				<tr>
					<td>ID</td>
					<td id="req">-</td>
				</tr>
				<tr>
					<td>USER</td>
					<td id="user2">-</td>
				</tr>
				<tr>
					<td>TYPE</td>
					<td id="type2">-</td>
				</tr>
				<tr>
					<td>LIMIT</td>
					<td id="limit">-</td>
				</tr>
				<tr>
					<td>STATUS</td>
					<td><span id="reqStatus">-</span>
						<select id='status' name='status' required>
							<option value='Pending'>Pending</option>
							<option value='Approved'>Approved</option>
							<option value='Denied'>Denied</option>
						</select>
					</td>
				</tr>
			</tbody>
		</table>
	</div>

</body>

<script>
var firstName = sessionStorage.getItem('firstName');

document.getElementById("mainbody").innerHTML = "Welcome, to your profile " + firstName
    userId = parseInt(sessionStorage.getItem('userID'))

function populateTable(body) {
    console.log(Object.keys(body))
	//console.log(JSON.parse(body[0])['reqId'])
    //body = JSON.parse(body);
    console.log(typeof(body));
    document.getElementById("req").innerHTML = body[0].reqId
    document.getElementById("user2").innerHTML = body[0].userId
    document.getElementById("type2").innerHTML = body[0].cardType
    document.getElementById("limit").innerHTML = body[0].creditLimit
    document.getElementById("reqStatus").innerHTML = body[0].reqStatus
}

async function getrequestcredit() {
    const user_id = document.getElementById("idInput").value
	console.log(user_id);
    const url = `http://127.0.0.1:5000/requests/credit/${user_id}`
    const httpResponse = await fetch(url)
    const body = await httpResponse.json()
    console.log(body)
    populateTable(body)
}

async function approvecredit() {

let status2 = document.getElementById("status").value

const req_id = document.getElementById("req").innerHTML
const user_id = document.getElementById("user2").innerHTML
const card_type = document.getElementById("type2").innerHTML
const card_limit = document.getElementById("limit").innerHTML
const url = `http://127.0.0.1:5000/request/credit/${user_id}`;

const data = {
    reqId: req_id,
    userId: user_id,
	cardType: card_type,
    creditLimit: card_limit,
    reqStatus: status2
}

console.log(data)

const httpresponse = fetch(url, {
	method: "PUT",
	body: JSON.stringify(data),
	headers: {
		"Content-Type": "application/json"
	}
});

httpresponse.then(response => {
	if(response.status==201){
		alert("You have successfully approved this request")
		document.getElementById("reqStatus").innerHTML = document.getElementById("status").value
        correct = true;
	}else{
		alert("Please try again - Could not submit approval");
        console.log("Failure"); 
	}
})
}

</script>

</html>